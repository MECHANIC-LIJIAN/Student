<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" type="IMG/x-icon" href="/favicon.ico" />
    <title>{$tname}</title>
    <!-- Bootstrap core CSS -->
    <link href="__CSS__/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="__CSS__/bootstrap-theme.min.css" rel="stylesheet">
    <link href="__CSS__/font-awesome.min.css" rel="stylesheet">
    <link href="__CSS__/mysite.css" rel="stylesheet">

    <style>
        html {
            overflow-x: hidden;
            overflow-y: auto;
        }

        body {

            background-image: url("__IMG__/bg.jpg");

            background-position: center 0;

            background-repeat: no-repeat;

            background-attachment: fixed;

            background-size: cover;

            -webkit-background-size: cover;

            -o-background-size: cover;

            -moz-background-size: cover;

            -ms-background-size: cover;

        }

        .project-block-backgound {
            background: #fff;
            border-radius: 4px;
        }

        #subForm {
            margin: 20px 30px 50px 30px;
        }

        #subForm label.error {
            color: red;
        }
    </style>
</head>


<body>
    <div class="container" style="margin-top: 50px;margin-bottom: 50px;">
        <div class="row col-xs-offset-1">
            <div class="col-xs-11 project-block-background">
                {present name="$hello"}
                <h1>{$hello}</h1>
                {else /}
                <form class="form-horizontal" role="form" id="subForm" autocomplete="off">
                    <fieldset>
                        <legend>{$tname}</legend>
                        <!-- 输出input -->
                        {volist name="optionList" id='option'}
                        {eq name="$option.child|count" value="0"}
                        <div class="form-group">
                            <label for="{$option.title}" class="col-sm-10">{$option.title}</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control required {$option.rule}" id="{$option.sid}"
                                    name="{$option.sid}">
                            </div>
                        </div>
                        {else /}
                        <div class="form-group">
                            <label for="{$option.title}" class="col-sm-10">{$option.title}</label>
                            <div class="col-sm-4">
                                <select class="form-control" required="true" name="{$option.sid}">
                                    <option value="">--请选择--</option>
                                    {volist name="option.child" id="vo"}
                                    <option value="{$vo.title}">{$vo.title}</option>
                                    {/volist}
                                </select>
                            </div>
                        </div>
                        {/eq}
                        {/volist}
                        <div class="for-group">
                            <input type="button" class="btn btn-success col-xs-4 col-xs-offset-4" id="submitOpt"
                                value="提交">
                        </div>
                    </fieldset>
                </form>
                {/present}
            </div>
        </div>
    </div>

    <script src="__JS__/jquery.min.js"></script>
    <script src="__JS__/bootstrap.min.js"></script>
    <script src="__LIB__/layer/layer.js"></script>
    <script src="__LIB__/layer_mobile/layer.js"></script>
    <script src="__JS__/jquery.validate.min.js"></script>
    <script src="__JS__/messages_zh.min.js"></script>
    <script>

        function IsPC() {
            var userAgentInfo = navigator.userAgent;
            var Agents = ["Android", "iPhone",
                "SymbianOS", "Windows Phone",
                "iPad", "iPod"];
            var flag = true;
            for (var v = 0; v < Agents.length; v++) {
                if (userAgentInfo.indexOf(Agents[v]) > 0) {
                    flag = false;
                    break;
                }
            }
            return flag;
        };
        var isPC = IsPC();
        if (isPC) {
            layer = layer;
            function showMsg(msg) {
                layer.msg(
                    msg, {
                    icon: 6,
                    time: 2000
                })
            }

            function showMsgAndHref(data) {
                layer.msg(
                    data.msg, {
                    icon: 6,
                    time: 2000
                },
                    function () {
                        location.href = data.url;
                    }
                );
            }

            function showErrorMsg(msg) {
                layer.open({
                    title: "错误！",
                    content: msg,
                    icon: 5,
                    anim: 5
                });
            }

            function confirm(msg, title, url, data) {
                layer.confirm(msg, {
                    title: title,
                    icon: 3
                }, function (index) {
                    layer.close(index);
                    $.ajax({
                        url: url,
                        type: 'post',
                        data: data,
                        dataType: 'json',
                        success: function (data) {
                            if (data.code == 1) {
                                showMsgAndHref(data)
                            } else {
                                showErrorMsg(data.msg)
                            }
                        }
                    });
                });
            }
        }
        else {
            layer = mobile;
            function showMsg(msg) {
                //提示
                layer.open({
                    content: msg
                    , skin: 'msg'
                    , time: 2 //2秒后自动关闭
                });
            }

            function showMsgAndHref(data) {
                layer.open({
                    content: data.msg
                    , btn: '我知道了'
                    , end: function (index) {
                        setTimeout(function () {
                            // $.mobile.changePage(data.url); //手机网页式跳转
                            location.href = data.url
                        }, 1000);
                    }
                });
            }
            function showErrorMsg(msg) {
                layer.open({
                    content: msg
                    , btn: '我知道了'
                });
            }
            
            //询问框
            function confirm(msg,title, url, data) {
                layer.open({
                    content: msg
                    , btn: ['确认', '取消']
                    , yes: function (index) {
                        $.ajax({
                            url: url,
                            type: 'post',
                            data: data,
                            success: function (data) {
                                if (data.code == 1) {
                                    showMsgAndHref(data)
                                } else {
                                    showErrorMsg(data.msg)
                                }
                            }
                        });
                    }
                });
            }
        }
    </script>
    <script>
        $(function () {
            $("#submitOpt").click(function () {
                $("#subForm").submit()
            })
        })
        $().ready(function () {
            $("#subForm").validate(
                {
                    submitHandler: function (form) {
                        $.ajax({
                            url: "{:url('index/Template/collect')}",
                            type: "post",
                            dataType: 'json',
                            data: $('form').serialize(),
                            success: function (data) {
                                if (data.code == 1) {
                                    showMsgAndHref(data)
                                } else if (data.code == 101) {
                                    if (isPC) {
                                        confirm(data.msg, '数据覆盖确认', "{:url('index/Template/collect')}", $('form').serialize())
                                    } else {
                                        confirm(data.msg,'该记录已存在，确认覆盖吗?',"{:url('index/Template/collect')}",$('form').serialize())
                                    }
                                } else {
                                    showErrorMsg("提交失败")
                                }
                            },
                        });
                    }
                });
        });
    </script>
</body>

</html>