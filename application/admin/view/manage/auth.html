{extend name="public/admin_base"}

{block name="title"}权限管理{/block}

{block name="page-main"}
<!--添加权限-->
<div class="modal fade" id="thinkright-add" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <button onclick="add()" class="modal-title" id="myModalLabel">
                    添加权限
                </button>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" action="{:url('admin/role/addAuth')}" method="post">
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="col-sm-3 control-label" for="demo-hor-inputemail">权限名称</label>
                            <div class="col-sm-9">
                                <input type="hidden" name="pid" value="0">
                                <input type="text" id="demo-hor-inputemail" class="form-control" name="title"
                                    required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label" for="demo-hor-inputpass">权限</label>
                            <div class="col-sm-9">
                                <input type="text" id="demo-hor-inputpass" class="form-control" name="name"
                                    required="required">
                                <span class="text-warning">输入模块/控制器/方法即可, 例如 admin/role/index</span>
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer text-right">
                        <button class="btn btn-success" type="submit">提交</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--修改权限-->
<div class="modal fade" id="thinkright-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel2">
                    修改权限
                </h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" action="{:url('Admin/role/editAuth')}" method="post">
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="col-sm-3 control-label" for="demo-hor-inputemail">权限名称</label>
                            <div class="col-sm-9">
                                <input type="hidden" name="id">
                                <input type="text" id="demo-hor-inputemail2" class="form-control" name="title"
                                    required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label" for="demo-hor-inputpass">权限</label>
                            <div class="col-sm-9">
                                <input type="text" id="demo-hor-inputpass2" class="form-control" name="name"
                                    required="required">
                                <span class="text-danger">输入模块/控制器/方法即可，例如 admin/role/index</span>
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer text-right">
                        <button class="btn btn-success" type="submit">修改</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Data Tables -->
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins" style="background: white;padding: 10px">
                <!-- 表单标题概要 -->
                <div class="ibox-title">
                    <h5>{:lang('Auth List')}</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <!-- 表单内容 -->
                <div class="ibox-content">
                    <!-- 用户控件（操作） -->
                    <!--{toolbar id="toolbar"}-->
                    <!--{/toolbar}-->
                    <div class="toolbar">
                        <div class="btn-group">
                            <button class="btn btn-primary" data-toggle="modal" data-target="#myModal" οnclick="add()">
                                <i class="fa fa-plus" aria-hidden="true" style="margin-right: 2px"></i>
                                添加权限
                            </button>
                        </div>
                    </div>
                    <!-- 表格数据 -->
                    <!--<table id="authtable" data-toggle="gridview" class="table"-->
                    <!--data-url="{:url('admin/role/getList')}"-->
                    <!--data-toolbar="#toolbar" data-show-columns="true"-->
                    <!--data-page-size="10"-->
                    <!--data-page-list="[10, 25, 50, All]" data-unique-id="id" data-pagination="true"-->
                    <!--data-side-pagination="client" data-search="true" data-click-to-select="false">-->
                    <!--<thead>-->
                    <!--<tr>-->
                    <!--<th data-width="40" data-checkbox="true"></th>-->
                    <!--<th data-width="100" data-field="rolename">{:lang('Role Name')}</th>-->
                    <!--<th data-width="100" data-field="status">{:lang('Status')}</th>-->
                    <!--<th data-width="200" data-field="note">{:lang('Note')}</th>-->
                    <!--<th data-width="300" data-field="operate" data-align="center" data-formatter="operateFormatter" data-events="operateEvents">{:lang('Operate')}</th>-->
                    <!--</tr>-->
                    <!--</thead>-->
                    <!--</table>-->
                    <table id="demo-dt-basic" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>权限名称</th>
                                <th>权限</th>
                                <th class="min-tablet">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {foreach name="data" id="v"}
                            <tr>
                                <td>{$v['_name']}</td>
                                <td>{$v['name']}</td>
                                <td>
                                    <a href="javascript:;" ruleId="{$v['id']}" οnclick="add_child(this)">添加子权限</a> |
                                    <a href="javascript:;" ruleId="{$v['id']}" ruleName="{$v['name']}"
                                        ruleTitle="{$v['title']}" οnclick="edit(this)">修改</a> |
                                    <a
                                        href="javascript:if(confirm('确定删除？'))location='{:url('Admin/Role/deleteAuth',array('id'=>$v['id']))}'">删除</a>
                                </td>
                            </tr>
                            {/foreach}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>



{/block}
{block name="page-js"}
<script type="text/javascript">
    /*添加权限*/
    function add() {
        $("input[name='title'],input[name='name']").val('');
        $("input[name='pid']").val(0);
        $('#thinkright-add').modal('show');
    }


    // 添加子菜单
    function add_child(obj) {
        var ruleId = $(obj).attr('ruleId');
        $("input[name='pid']").val(ruleId);
        $("input[name='title']").val('');
        $("input[name='name']").val('');
        $('#thinkright-add').modal('show');
    }

    // 修改菜单
    function edit(obj) {
        var ruleId = $(obj).attr('ruleId');
        var ruletitle = $(obj).attr('ruletitle');
        var ruleName = $(obj).attr('ruleName');
        $("input[name='id']").val(ruleId);
        $("input[name='title']").val(ruletitle);
        $("input[name='name']").val(ruleName);
        $('#thinkright-edit').modal('show');
    }
</script>

{/block}